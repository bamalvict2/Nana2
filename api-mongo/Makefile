# ğŸ³ Active l'environnement Docker de Minikube
docker-env:
	eval $$(minikube docker-env)

# ğŸš€ DÃ©marre Minikube
start:
	minikube start

# ğŸ”„ Reset complet du cluster Minikube
reset:
	minikube stop && minikube delete && minikube start

# ğŸ“¦ Build l'image localement (si tu n'utilises pas DockerHub)
build:
	docker build -t nana-api:latest .

# ğŸ“„ DÃ©ploie les fichiers YAML
deploy:
	kubectl apply -f k8s/nana-api-deployment.yaml
	kubectl apply -f k8s/nana-api-service.yaml

# ğŸ” VÃ©rifie que les fichiers YAML sont valides
validate-yaml:
	kubectl apply --dry-run=client -f k8s/nana-api-deployment.yaml
	kubectl apply --dry-run=client -f k8s/nana-api-service.yaml

# ğŸ” RedÃ©marre uniquement le pod nana-api
restart:
	kubectl delete pod -l app=nana-api
	kubectl apply -f k8s/nana-api-deployment.yaml

# ğŸŒ Expose l'API Nana en local
port:
	kubectl port-forward svc/nana-api 3000:3000

# ğŸ§ª Teste l'endpoint principal
test-api:
	curl http://localhost:3000/api/test

# ğŸ§¹ Supprime tous les objets liÃ©s Ã  Nana API
clean-all:
	kubectl delete -f k8s/

# ğŸ“Š Affiche l'Ã©tat des pods et services
status:
	kubectl get pods
	kubectl get svc

# ğŸ“ Affiche les logs du pod nana-api
logs:
	kubectl logs deployment/nana-api

# ğŸ§­ Rejoue tout le cockpit en une commande
replay-chicago: start docker-env build validate-yaml deploy port test-api